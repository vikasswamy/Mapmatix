{"version":3,"file":"colorin.js","sources":["../index.js"],"sourcesContent":["let canvas;\r\nconst OPTIONS = {\r\n    width: 100,\r\n    height: 10\r\n};\r\n\r\nfunction getCanvas() {\r\n    if (!canvas) {\r\n        const { width, height } = OPTIONS;\r\n        if (OffscreenCanvas) {\r\n            canvas = new OffscreenCanvas(width, height);\r\n        } else {\r\n            canvas = document.createElement('canvas');\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n        }\r\n    }\r\n    return canvas;\r\n}\r\n\r\nexport class ColorIn {\r\n    constructor(colors, options = {}) {\r\n        if (!Array.isArray(colors)) {\r\n            console.error('colors is not array');\r\n            return;\r\n        }\r\n        if (colors.length < 2) {\r\n            console.error('colors.length should >1');\r\n            return;\r\n        }\r\n        this.colors = colors;\r\n        let min = Infinity, max = -Infinity;\r\n        for (let i = 0, len = colors.length; i < len; i++) {\r\n            const value = colors[i][0];\r\n            min = Math.min(value, min);\r\n            max = Math.max(value, max);\r\n        }\r\n        this.min = min;\r\n        this.max = max;\r\n        this.valueOffset = this.max - this.min;\r\n        this.options = Object.assign({}, OPTIONS, options);\r\n        this._initImgData();\r\n    }\r\n\r\n    getImageData() {\r\n        return this.imgData;\r\n    }\r\n\r\n    _initImgData() {\r\n        const canvas = getCanvas();\r\n        const { width, height } = this.options;\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);\r\n        const { colors, valueOffset } = this;\r\n        for (let i = 0, len = colors.length; i < len; i++) {\r\n            const [stop, color] = colors[i];\r\n            const s = (stop - this.min) / valueOffset;\r\n            gradient.addColorStop(s, color);\r\n        }\r\n        ctx.fillStyle = gradient;\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n        this.imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n    }\r\n\r\n    getColor(stop) {\r\n        stop = Math.max(this.min, stop);\r\n        stop = Math.min(stop, this.max);\r\n        const s = (stop - this.min) / this.valueOffset;\r\n        let x = Math.round(s * this.imgData.width);\r\n        x = Math.min(x, this.imgData.width - 1);\r\n        const idx = x * 4;\r\n        const r = this.imgData.data[idx];\r\n        const g = this.imgData.data[idx + 1];\r\n        const b = this.imgData.data[idx + 2];\r\n        const a = this.imgData.data[idx + 3];\r\n        return [r, g, b, a];\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}